<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>M.ESA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header class="site-header">
    <div class="logo-area">
        <svg class="mesa-logo" viewBox="0 0 140 24" role="img" aria-label="Mesa">
            <text x="0" y="20"
                  font-size="20"
                  font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                  font-weight="700">
                M
            </text>

            <circle cx="25.5" cy="16" r="3" fill="currentColor" />

            <text x="32" y="20"
                  font-size="20"
                  font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                  font-weight="700"
                  letter-spacing="1">
                ESA
            </text>
        </svg>
    </div>

    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
        <span></span><span></span><span></span>
    </button>

    <div class="header-right" id="headRight">
        <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Close menu">×</button>

        <nav class="main-nav">
            <button id="menuPageBtn" class="nav-link" data-i18n="nav.menu">Menu</button>
            <button id="bookingPageBtn" class="nav-link" data-i18n="nav.book">Book</button>
        </nav>

        <div class="auth-nav">
            <div class="nav-language-switcher">
                <select id="navLanguageSelect">
                    <option value="pt" selected>PT</option>
                    <option value="en">EN</option>
                </select>
            </div>

            <button id="loginBtn" class="btn ghost" data-i18n="nav.login">Login</button>
            <button id="registerBtn" class="btn primary" data-i18n="nav.register">Sign up</button>
            <button id="logoutBtn" class="btn ghost hidden" data-i18n="nav.logout">Logout</button>
            <button id="accountBtn" class="nav-link hidden" data-i18n="nav.account">My Account</button>
            <button id="adminPageBtn" class="nav-link admin-only hidden" data-i18n="nav.admin">Admin</button>
            <button id="kitchenPageBtn" class="nav-link kitchen-only hidden" data-i18n="nav.kitchen">Kitchen</button>
        </div>
    </div>
</header>

<main>

    <section id="menu-section" class="page">

        <section class="hero-full">
            <div class="hero-container">

                <div class="hero-left">
                    <h1 class="hero-title">
                        <span data-i18n="hero.title.line1">Real Portuguese food.</span>
                        <br class="hero-title-break">
                        <span data-i18n="hero.title.line2">Discipline without effort.</span>
                    </h1>

                    <p class="hero-subtitle" data-i18n="hero.subtitle">
                        <span data-i18n="hero.subtitle.line1">Fresh meals cooked daily and delivered the same day.</span>
                        <br class="hero-subtitle-break">
                        <span data-i18n="hero.subtitle.line2">High protein, lower carbs, zero cooking.</span>
                    </p>

                    <div class="hero-actions">
                        <button class="btn primary" id="heroFoundersBtn" data-i18n="hero.foundersCta">Start your week at the M•ESA</button>
                        <button class="btn ghost" id="heroViewPlansBtn" data-i18n="hero.viewPlansCta">View Plans</button>
                    </div>

                    <ul class="hero-underline" data-i18n="hero.underline">
                        <li data-i18n="hero.meta.meals">3–14 refeições/semana</li>
                        <li data-i18n="hero.meta.price">Preço a partir de 9,45€</li>
                        <li data-i18n="hero.meta.delivery">Entrega em casa, trabalho ou ginásio</li>
                    </ul>
                </div>

                <div class="hero-right">
                    <img src="assets/hero.png" class="hero-image" alt="Mesa meal">
                </div>

            </div>
        </section>

        <section class="launch-strip">
            <span data-i18n="launch.strip">
                Launch promo — first week 50% OFF meals delivered Jan 2–4 only.
            </span>
        </section>

        <section class="how-it-works-wrapper">
            <div class="how-it-works" id="howItWorks">
                <h2 data-i18n="how.title">How it works</h2>
                <div class="steps-grid">
                    <div class="step-card">
                        <div class="step-icon-wrap">
                            <img src="assets/icons/meal.svg" alt="" class="step-icon">
                        </div>
                        <h3 data-i18n="how.step1.title">Choose your meals</h3>
                        <p data-i18n="how.step1.text">Browse our weekly menu and confirm the days.</p>
                    </div>
                    <div class="step-card">
                        <div class="step-icon-wrap">
                            <img src="assets/icons/calendar.svg" alt="" class="step-icon">
                        </div>
                        <h3 data-i18n="how.step2.title">Pre-order before cutoff</h3>
                        <p data-i18n="how.step2.text">Place your order every week before Monday 23:59.</p>
                    </div>
                    <div class="step-card">
                        <div class="step-icon-wrap">
                            <img src="assets/icons/truck.svg" alt="" class="step-icon">
                        </div>
                        <h3 data-i18n="how.step3.title">We cook &amp; deliver</h3>
                        <p data-i18n="how.step3.text">Get fresh meals in sealed trays with labeled nutrition stickers.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mesa-section mesa-two-column" id="why-mesa">
            <div class="mesa-column">
                <h2 data-i18n="why.title">Why M•ESA?</h2>
                <ul class="mesa-list">
                    <li data-i18n="why.item1">Portuguese recipes adapted to your lifestyle</li>
                    <li data-i18n="why.item2">High protein in every meal</li>
                    <li data-i18n="why.item3">Fewer carbs, less fat, more flavour</li>
                    <li data-i18n="why.item4">Cooked and delivered on the same day</li>
                    <li data-i18n="why.item5">Daily delivery • Varied menu • On commitment</li>
                    <li data-i18n="why.item6">One single platform to manage everything</li>
                </ul>
            </div>

            <div class="mesa-column" id="weekly-plans">
                <h2 data-i18n="plans.title">Weekly Plans</h2>
                <ul class="mesa-plans-list">
                    <li>
                        <strong data-i18n="plans.tier1.label">3–5 meals per week</strong>
                        <span data-i18n="plans.tier1.price">10.50 € per meal</span>
                    </li>
                    <li>
                        <strong data-i18n="plans.tier2.label">6–8 meals per week</strong>
                        <span data-i18n="plans.tier2.price">9.99 € per meal</span>
                    </li>
                    <li>
                        <strong data-i18n="plans.tier3.label">10–14 meals per week</strong>
                        <span data-i18n="plans.tier3.price">9.45 € per meal</span>
                    </li>
                </ul>
                <p class="mesa-small-print" data-i18n="plans.note">
                    Prices may change with launch campaigns or promotions.
                </p>
            </div>
        </section>

        <section class="mesa-section mesa-founders" id="founders-plan">
            <div class="founders-inner">
                <div class="founders-content">
                    <h2 data-i18n="founders.title">Founders Plan — Limited Spots</h2>

                    <p class="founders-sub" data-i18n="founders.subtitle">
                        Join the M•ESA launch and secure lifetime benefits.
                    </p>

                    <ul class="founders-benefits">
                        <li data-i18n="founders.benefit1">€1 discount per meal forever</li>
                        <li data-i18n="founders.benefit2">Early access to menus</li>
                        <li data-i18n="founders.benefit3">Priority delivery</li>
                        <li data-i18n="founders.benefit4">No commitment</li>
                    </ul>
                </div>

                <div class="founders-action">
                    <button class="btn founders-btn" id="foundersCtaBtn" data-i18n="founders.button">
                        Join the Founders Plan
                    </button>
                </div>
            </div>
        </section>

        <section class="mesa-section mesa-who">
            <h2 data-i18n="who.title">Who is M•ESA for?</h2>

            <div class="mesa-who-grid">
                <div class="who-card">
                    <div class="who-icon">
                        <img src="assets/icons/arm.svg" alt="" class="who-icon-img">
                    </div>
                    <h3 data-i18n="who.train.title">For people who train</h3>
                </div>

                <div class="who-card">
                    <div class="who-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="9"/>
                            <path d="M12 7v5l3 2"/>
                        </svg>
                    </div>
                    <h3 data-i18n="who.work.title">For people who work a lot</h3>
                </div>

                <div class="who-card">
                    <div class="who-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="5" width="16" height="15" rx="2"/>
                            <path d="M4 10h16"/>
                            <path d="M9 3v4"/>
                            <path d="M15 3v4"/>
                        </svg>
                    </div>
                    <h3 data-i18n="who.discipline.title">For people who want discipline</h3>
                </div>
            </div>
        </section>
</section> <!-- END #menu-section -->

    <!-- BOOKING PAGE -->
    <section id="booking-section" class="page hidden">
        <h2 data-i18n="booking.title">Plan your meals for the week</h2>
        <p class="section-description" data-i18n="booking.description">
            Minimum 3 meals per service week and maximum 14.
            1 meal → choose A or B. 2 meals → you receive both dishes.
        </p>

        <form id="bookingForm" class="card">
            <div class="form-row">
                <label for="bookingDate" data-i18n="booking.dateLabel">Delivery date</label>
                <input type="date" id="bookingDate" required>
            </div>

            <div class="form-row">
                <label for="bookingAddress" data-i18n="booking.addressLabel">Delivery address</label>
                <select id="bookingAddress" required>
                    <option value="" data-i18n="booking.addressLoading">Loading addresses...</option>
                </select>
            </div>

            <div class="form-row two-cols">
                <div>
                    <label for="bookingMeals" data-i18n="booking.mealsLabel">Number of meals for this day</label>
                    <select id="bookingMeals" required>
                        <option value="1" data-i18n="booking.mealsOption1">1 meal</option>
                        <option value="2" data-i18n="booking.mealsOption2">2 meals</option>
                    </select>
                </div>
                <div>
                    <label for="bookingDish" data-i18n="booking.dishLabel">Dish (only if 1 meal)</label>
                    <select id="bookingDish">
                        <option value="" data-i18n="booking.dishSelect">Select</option>
                        <option value="A" data-i18n="booking.dishA">Dish A</option>
                        <option value="B" data-i18n="booking.dishB">Dish B</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <label for="bookingSlot" data-i18n="booking.slotLabel">Time slot (15 min)</label>
                <select id="bookingSlot" required>
                    <option value="" data-i18n="booking.slotSelectFirst">Select a date first</option>
                </select>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn primary" data-i18n="booking.addButton">Add booking</button>
            </div>
        </form>

        <section class="card">
            <h3 data-i18n="booking.listTitle">Your bookings for this service week</h3>
            <table class="data-table">
                <thead>
                <tr>
                    <th data-i18n="booking.table.date">Date</th>
                    <th data-i18n="booking.table.time">Time</th>
                    <th data-i18n="booking.table.meals">Meals</th>
                    <th data-i18n="booking.table.dish">Dish</th>
                    <th data-i18n="booking.table.address">Address</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="bookingTableBody">
                <tr><td colspan="6" data-i18n="booking.table.empty">No bookings yet.</td></tr>
                </tbody>
            </table>

            <div id="bookingPricing" class="pricing-summary"></div>
        </section>
    </section>

    <!-- ACCOUNT / ADDRESSES -->
    <section id="account-section" class="page hidden">
        <h2 data-i18n="account.title">My account</h2>

        <section class="card">
            <h3 data-i18n="account.detailsTitle">My details</h3>
            <div class="form-row readonly-row">
                <label data-i18n="account.nameLabel">Name</label>
                <div id="userNameDisplay" class="readonly-field">–</div>
            </div>

            <div class="form-row readonly-row">
                <label data-i18n="account.emailLabel">Email</label>
                <div id="userEmailDisplay" class="readonly-field">–</div>
            </div>

            <div class="form-row readonly-row">
                <label data-i18n="account.phoneLabel">Phone</label>
                <div id="userPhoneDisplay" class="readonly-field">–</div>
            </div>

            <p class="section-description" data-i18n="account.editInfo">
                To change your email, phone or name, contact support. You can only edit delivery addresses here.
            </p>

            <h3 data-i18n="account.addressesTitle">Delivery addresses</h3>
            <p class="section-description" data-i18n="account.addressesInfo">
                You can register up to three addresses (for example home, office, and gym).
            </p>

            <form id="addressForm">
                <input type="hidden" id="addrId">

                <div class="form-row">
                    <label for="addressLabelSelect" data-i18n="account.labelSelect">Label</label>
                    <select id="addressLabelSelect">
                        <option value="Home" data-i18n="account.label.home">Home</option>
                        <option value="Office" data-i18n="account.label.office">Office</option>
                        <option value="Gym" data-i18n="account.label.gym">Gym</option>
                        <option value="School" data-i18n="account.label.school">School</option>
                        <option value="Restaurant" data-i18n="account.label.restaurant">Restaurant</option>
                        <option value="Other" data-i18n="account.label.other">Other</option>
                    </select>
                </div>

                <div class="form-row hidden" id="customLabelWrapper">
                    <label for="customLabelInput" data-i18n="account.customLabel">Custom label</label>
                    <input type="text" id="customLabelInput" placeholder="E.g. Mother's house">
                </div>

                <div class="form-row">
                    <label for="addrLine1" data-i18n="account.addrLine1">Street and Number:</label>
                    <input type="text" id="addrLine1" required>
                </div>

                <div class="form-row">
                    <label for="addrLine2" data-i18n="account.addrLine2">Floor or Appartment No:</label>
                    <input type="text" id="addrLine2">
                </div>

                <div class="form-row two-cols">
                    <div>
                        <label for="addrCity" data-i18n="account.city">City</label>
                        <input type="text" id="addrCity" required>
                    </div>
                    <div>
                        <label for="addrPostal" data-i18n="account.postal">Postal code</label>
                        <input type="text" id="addrPostal" required>
                    </div>
                </div>

                <div class="form-row">
                    <label for="addrNotes" data-i18n="account.notes">Notes for driver / kitchen</label>
                    <textarea id="addrNotes" rows="2"></textarea>
                </div>

                <div class="form-row checkbox-row">
                    <label>
                        <input type="checkbox" id="addrDefault">
                        <span data-i18n="account.default">Use as default address</span>
                    </label>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn primary" data-i18n="account.saveAddress">Save address</button>
                    <button type="button" class="btn ghost" onclick="resetAddressForm()" data-i18n="account.clear">Clear</button>
                </div>
            </form>

            <table class="data-table">
                <thead>
                <tr>
                    <th data-i18n="account.table.label">Label</th>
                    <th data-i18n="account.table.address">Address</th>
                    <th data-i18n="account.table.city">City</th>
                    <th data-i18n="account.table.postal">Postal</th>
                    <th data-i18n="account.table.default">Default</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="addressList">
                <tr><td colspan="6" data-i18n="account.table.empty">No addresses yet.</td></tr>
                </tbody>
            </table>
        </section>

        <!-- BEHAVIOUR TABLE (BOTTOM) -->
        <section class="card" id="behaviourCard" style="margin-top: 1rem;">
            <h3>Behaviour Pattern</h3>
            <p class="section-description">
                Your onboarding behaviour table (read-only).
            </p>

            <table class="data-table">
                <thead>
                <tr>
                    <th>Day</th>
                    <th>Meals</th>
                    <th>Dish</th>
                    <th>Time Slot</th>
                </tr>
                </thead>
                <tbody id="behaviourTableBody">
                <tr><td colspan="4">No behaviour data yet.</td></tr>
                </tbody>
            </table>
        </section>
    </section>

    <!-- ADMIN PANEL -->
    <section id="admin-section" class="page hidden">
        <h2 data-i18n="admin.title">Admin dashboard</h2>

        <section class="card">
            <h3 data-i18n="admin.regionsTitle">Service regions</h3>
            <form id="regionForm">
                <input type="hidden" id="regionId">
                <div class="form-row">
                    <label for="regionName" data-i18n="admin.regionName">Region name</label>
                    <input type="text" id="regionName" placeholder="Ex: Aliados, Matosinhos, Foz" required>
                </div>
                <div class="form-row">
                    <label for="regionNotes" data-i18n="admin.regionNotes">Notes</label>
                    <textarea id="regionNotes" rows="2"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary" data-i18n="admin.saveRegion">Save region</button>
                </div>
            </form>

            <table class="data-table">
                <thead>
                <tr>
                    <th data-i18n="admin.table.name">Name</th>
                    <th data-i18n="admin.table.notes">Notes</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="regionList">
                <tr><td colspan="3" data-i18n="admin.table.empty">No regions yet.</td></tr>
                </tbody>
            </table>
        </section>

        <section class="card">
            <h3 data-i18n="admin.menuPlanningTitle">Menu planning (per day)</h3>
            <div id="menuPlanList"></div>
        </section>

        <section class="card">
            <h3 data-i18n="admin.exportsTitle">Exports</h3>
            <p class="section-description" data-i18n="admin.exportsDescription">
                Download client list and weekly bookings as CSV files.
            </p>
            <div class="form-row">
                <label for="admin-export-week-start" data-i18n="admin.exportWeekStart">Service week start (Monday)</label>
                <input type="date" id="admin-export-week-start">
            </div>
            <div class="form-actions">
                <button id="admin-export-clients-btn" type="button" class="btn ghost" data-i18n="admin.exportClients">
                    Download clients CSV
                </button>
                <button id="admin-export-bookings-btn" type="button" class="btn ghost" data-i18n="admin.exportBookings">
                    Download bookings CSV
                </button>
            </div>
        </section>
    </section>

    <!-- KITCHEN PANEL -->
    <section id="kitchen-section" class="page hidden">
        <h2 data-i18n="kitchen.title">Kitchen daily sheet</h2>

        <section class="card">
            <div class="form-row">
                <label for="kitchenDate" data-i18n="kitchen.dateLabel">Delivery date</label>
                <input type="date" id="kitchenDate">
            </div>
            <div class="form-actions">
                <button id="kitchenPrint" class="btn ghost" type="button" data-i18n="kitchen.print">Print</button>
                <button id="kitchenExportCsv" class="btn ghost" type="button" data-i18n="kitchen.exportCsv">Export CSV</button>
            </div>
        </section>

        <section class="card">
            <div id="kitchenDeliveryList"></div>
        </section>
    </section>

</main>

<!-- AUTH MODALS -->
<div id="modalOverlay" class="modal-overlay hidden"></div>

<div id="loginModal" class="modal hidden">
    <div class="modal-header">
        <h3 data-i18n="login.title">Login</h3>
        <button class="closeModal">×</button>
    </div>

    <form id="loginForm" class="modal-body">
        <div class="form-row">
            <label for="loginEmail" data-i18n="login.emailLabel">Email</label>
            <input type="email" id="loginEmail" required>
        </div>

        <div class="form-row">
            <label for="loginPassword" data-i18n="login.passwordLabel">Password</label>
            <div class="password-wrapper">
                <input type="password" id="loginPassword" required>
                <button type="button" class="password-toggle" data-target="loginPassword" data-i18n="login.show">
                    Show
                </button>
            </div>
        </div>

        <div class="form-row" style="text-align: right; margin-top: 0.25rem;">
            <button type="button" id="forgotPasswordLink" class="link-button" data-i18n="login.forgotPassword">
                Forgot password?
            </button>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn primary" data-i18n="login.submit">Login</button>
        </div>
    </form>
</div>

<div id="registerModal" class="modal hidden">
    <div class="modal-header">
        <h3 data-i18n="register.title">Create account</h3>
        <button class="closeModal">×</button>
    </div>
    <form id="registerForm" class="modal-body">
        <div class="form-row">
            <label for="regName" data-i18n="register.nameLabel">Name</label>
            <input type="text" id="regName" required>
        </div>
        <div class="form-row">
            <label for="regEmail" data-i18n="register.emailLabel">Email</label>
            <input type="email" id="regEmail" required>
        </div>
        <div class="form-row">
            <label for="regPhone" data-i18n="register.phoneLabel">Phone (optional)</label>
            <input type="text" id="regPhone">
        </div>
        <div class="form-row">
            <label for="regPassword" data-i18n="register.passwordLabel">Password</label>
            <div class="password-wrapper">
                <input type="password" id="regPassword" required>
                <button type="button" class="password-toggle" data-target="regPassword" data-i18n="register.show">
                    Show
                </button>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn primary" data-i18n="register.submit">Create account</button>
        </div>
    </form>
</div>

<div id="resetPasswordModal" class="modal hidden">
    <div class="modal-header">
        <h3 data-i18n="reset.title">Reset password</h3>
        <button class="closeModal">×</button>
    </div>
    <form id="resetPasswordForm" class="modal-body">
        <div class="form-row">
            <label for="resetEmail" data-i18n="reset.emailLabel">Email</label>
            <input type="email" id="resetEmail" required>
        </div>

        <div class="form-row">
            <label for="resetPhone" data-i18n="reset.phoneLabel">Phone (same as account)</label>
            <input type="text" id="resetPhone" placeholder="Optional but recommended">
        </div>

        <div class="form-row">
            <label for="resetNewPassword" data-i18n="reset.newPasswordLabel">New password</label>
            <div class="password-wrapper">
                <input type="password" id="resetNewPassword" required>
                <button type="button" class="password-toggle" data-target="resetNewPassword" data-i18n="reset.show">
                    Show
                </button>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn primary" data-i18n="reset.submit">Set new password</button>
        </div>
    </form>
</div>

<!-- IMPORTANT: i18n comes BEFORE the other JS -->
<script src="js/i18n.js"></script>
<script src="js/router.js"></script>
<script src="js/auth.js"></script>
<script src="js/user.js"></script>
<script src="js/menu.js"></script>
<script src="js/booking.js"></script>
<script src="js/admin.js"></script>
<script src="js/kitchen.js"></script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        console.log("Page router loaded");

        function storageGet(key) {
            try { return localStorage.getItem(key); } catch (_) { return null; }
            }
            function storageRemove(key) {
            try { localStorage.removeItem(key); } catch (_) {}
        }


        const menuBtn        = document.getElementById("menuPageBtn");
        const bookingBtn     = document.getElementById("bookingPageBtn");
        const accountBtn     = document.getElementById("accountBtn");
        const adminBtn       = document.getElementById("adminPageBtn");
        const kitchenBtn     = document.getElementById("kitchenPageBtn");

        const heroPlansBtn    = document.getElementById("heroViewPlansBtn");
        const heroFoundersBtn = document.getElementById("heroFoundersBtn");

        const mobileToggle   = document.getElementById("mobileMenuToggle");
        const headerRight    = document.getElementById("headRight");
        const mobileClose    = document.getElementById("mobileMenuClose");

        const navLanguageSelect = document.getElementById("navLanguageSelect");

        // Language init via js/i18n.js
        if (window.MesaI18n) {
            window.MesaI18n.initLanguageSelect(navLanguageSelect);
            window.MesaI18n.applyLanguage(window.MesaI18n.getLang());
        }

        function scrollToMenu() {
            const menuWeek = document.getElementById("menuWeekSection");
            if (!menuWeek) return;

            const header = document.querySelector(".site-header");
            const headerHeight = header ? header.offsetHeight : 0;

            const rect = menuWeek.getBoundingClientRect();
            const absoluteY = window.scrollY + rect.top;

            window.scrollTo({
                top: absoluteY - headerHeight - 16,
                behavior: "smooth"
            });
        }

        function showMenuAndScroll() {
            showPage("menu-section");
            const menuWeek = document.getElementById("menuWeekSection");
            if (menuWeek) {
                menuWeek.classList.remove("hidden");
            }
            scrollToMenu();
            closeMobileMenu();
        }

        // MOBILE MENU HELPERS
        function toggleMobileMenu() {
            if (!headerRight) return;
            headerRight.classList.toggle("open");
            document.body.classList.toggle("mobile-menu-open");
        }

        function closeMobileMenu() {
            if (!headerRight) return;
            headerRight.classList.remove("open");
            document.body.classList.remove("mobile-menu-open");
        }

        // Ensure starts closed
        if (headerRight) {
            headerRight.classList.remove("open");
        }

        // Burger click
        if (mobileToggle && headerRight) {
            mobileToggle.addEventListener("click", (e) => {
                e.stopPropagation();
                toggleMobileMenu();
            });
        }

        // Close "X" inside drawer
        if (mobileClose) {
            mobileClose.addEventListener("click", () => {
                closeMobileMenu();
            });
        }

        // MENU button
        if (menuBtn) {
            menuBtn.addEventListener("click", () => {
                showPage("menu-section");
                if (window.loadPublicMenu) window.loadPublicMenu();
                closeMobileMenu();
            });
        }


        // BOOK
        if (bookingBtn) {
            bookingBtn.addEventListener("click", async () => {
                showPage("booking-section");
                if (window.initializeBookingPage) await window.initializeBookingPage();
                closeMobileMenu();
            });
        }



        if (accountBtn) {
            accountBtn.addEventListener("click", async () => {
                showPage("account-section");
                if (window.initializeUserPage) await window.initializeUserPage();
                closeMobileMenu();
            });
        }


        if (adminBtn) {
            adminBtn.addEventListener("click", async () => {
                showPage("admin-section");
                if (window.initializeAdminPage) await window.initializeAdminPage();
                closeMobileMenu();
            });
        }


        if (kitchenBtn) {
            kitchenBtn.addEventListener("click", async () => {
                showPage("kitchen-section");
                if (window.initializeKitchenPage) await window.initializeKitchenPage();
                closeMobileMenu();
            });
        }


        if (heroPlansBtn) {
            heroPlansBtn.addEventListener("click", () => {
                showMenuAndScroll();
            });
        }

        // Onboarding redirect (capture to override any old modal handlers)
        function goToOnboarding(e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            window.location.href = "onboarding.html";
        }

        const registerBtn = document.getElementById("registerBtn");
        const foundersCtaBtn = document.getElementById("foundersCtaBtn");

        if (heroFoundersBtn) heroFoundersBtn.addEventListener("click", goToOnboarding, true);
        if (registerBtn) registerBtn.addEventListener("click", goToOnboarding, true);
        if (foundersCtaBtn) foundersCtaBtn.addEventListener("click", goToOnboarding, true);

        // If onboarding finished Step 6 and wants to go directly to booking
        const goBooking = storageGet("mesaGoBooking");
        if (goBooking === "1") {
            storageRemove("mesaGoBooking");
            showPage("booking-section");

            // booking.js is lazy-init, so call it here once
            if (window.initializeBookingPage) {
                window.initializeBookingPage();
            } else {
                console.warn("initializeBookingPage() not found. Check booking.js load order.");
            }

            closeMobileMenu();
            window.scrollTo({ top: 0, behavior: "instant" });
            return;
        }

        // Default landing page
        showPage("menu-section");

    });
</script>

</body>
</html>
